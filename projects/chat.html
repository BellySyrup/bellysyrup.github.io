
<!DOCTYPE html>
<html>
	<head>
		<!-- 
			app breaks when trying to load channel that does not exist
		-->
		<meta charset="UTF-8">
		<meta name="description" content="Multiple chat manager for twitch.tv">
		<meta name="keywords" content="twitch,stream,chat,multiple,manager">
		<meta name="author" content="Stephan Conzen">
		<title>Multiple Chat Monitor</title>
		<link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
		<script>			
			// var preloadArr = ['sodapoppin','etticey']; // add twitch users here

			var d = '<iframe frameborder="0" scrolling="no" id="chat_embed" src="http://twitch.tv/chat/embed?channel=';
			var e = '&amp;popout_chat=true" height="500" width="350"></iframe>';
			var morestring = '<div class="chat"><input placeholder="User Name"/><div class="close">x</div><div class="chatframe">&nbsp;</div></div>';
			var lang = $('html').attr('lang');

			var msg_intro = '<p>Click the + to add a new chat</p><p>Enter a user name and hit enter</p><p>Click the x to close a chat</p>';
			var msg_exists = 'new chat is already available';
			var msg_removed = 'removed ';
			var msg_adding = 'adding ';
			
			$(function(){
				var allownew = true;
				var timeout;
				var m = $('#msg');

				$('.more').click(function(){
					newUser();
				});

				msg(msg_intro,0);

				if (typeof preloadArr !== 'undefined') {
    				preload(preloadArr);
				}

				function newUser(){
					if(allownew){
						$(morestring).insertBefore('.more');
						allownew = false;
					} else {
						msg(msg_exists,2);
					}
					
					addnew();
					closethis();
				}

				function preload(x){
					if(x.length>0){
						m.hide();
					}
					$.each(x,function(index,value){
						newindex = index+1;
						console.log(newindex, index, value);
						$(morestring).insertBefore('.more');
						$('.chat:nth-child('+newindex+')').find('.chatframe').html(d+value+e);
						$('.chat:nth-child('+newindex+')').attr('data-user',value);
					});

					addnew();
					closethis();
				}

				function addnew(){
					$('.chat input').change(function(){
						var x = $(this).val();
						msg(msg_adding + x,2);
						$(this).parent().find('.chatframe').html(d+x+e);
						$(this).parent().attr('data-user',x)
						allownew = true;
					});
				}

				function closethis(){
					$('.close').click(function(){
						$(this).parent().remove();
						msg(msg_removed + $(this).parent().attr('data-user'),2);
						allownew = true;
					});
				}

				function msg(x,y){
					clearTimeout(timeout);
					m.hide();
					m.html(x);
					m.fadeIn();

					if(y!=0){
						timeout = window.setTimeout(function() {
				        $('#msg').fadeOut();
				    	}, y*1000);
					}
				}

			});
		</script>
		<style>
			body{
				font-family: sans-serif;
				color: #333;
				margin: 8px 0;
			}
			#msg{
				position: fixed;
				bottom: 0;
				right: 0;
				margin-right: 20px;
				margin-bottom: 20px;
				padding: 10px 15px;
				border-radius: 5px;
				font-weight: bold;
				border: 2px solid #f2f2f2;
				background: white;
			}
			#container{
				overflow: auto;
			}
			.chat{
				float:left;
				margin-left: 8px;
				margin-bottom: 8px;
				background: #f2f2f2;
				position: relative;
			}
			.chat input{
				box-sizing: border-box;
				width: 320px;
				height: 30px;
				padding-left: 8px;
			}
			.chat .close{
				height: 30px;
				width: 30px;
				float: right;
				line-height: 28px;
				background: white;
				border: 1px solid #ccc;
				border-left: none;
				box-sizing: border-box;
				cursor: pointer;
				text-align: center;
			}
			.chat .close:hover{
				background: #f2f2f2;
			}
			.chat .chatframe{
				height: 500px;
				width: 350px;
			}
			.more{
				height: 530px;
				width: 350px;
				background: #6441a5;
				color: white;
				float:left;
				font-size: 40px;
				font-weight: bold;
				line-height:530px;
				cursor: pointer;
				text-align: center;
				margin-left:8px;
				margin-bottom:8px;
			}
			.more:hover{
				opacity: 0.9;
			}
		</style>
	</head>
	<body><div id="container"><div class="more">+</div></div><div id="msg"></div></body>
</html>

<!--
quu..__
 $$$b  `---.__
  "$$b        `--.                          ___.---uuudP
   `$$b           `.__.------.__     __.---'      $$$$"              .
     "$b          -'            `-.-'            $$$"              .'|
       ".                                       d$"             _.'  |
         `.   /                              ..."             .'     |
           `./                           ..::-'            _.'       |
            /                         .:::-'            .-'         .'
           :                          ::''\          _.'            |
          .' .-.             .-.           `.      .'               |
          : /'$$|           .@"$\           `.   .'              _.-'
         .'|$u$$|          |$$,$$|           |  <            _.-'
         | `:$$:'          :$$$$$:           `.  `.       .-'
         :                  `"--'             |    `-.     \
        :##.       ==             .###.       `.      `.    `\
        |##:                      :###:        |        >     >
        |#'     `..'`..'          `###'        x:      /     /
         \                                   xXX|     /    ./
          \                                xXXX'|    /   ./
          /`-.                                  `.  /   /
         :    `-  ...........,                   | /  .'
         |         ``:::::::'       .            |<    `.
         |             ```          |           x| \ `.:``.
         |                         .'    /'   xXX|  `:`M`M':.
         |    |                    ;    /:' xXXX'|  -'MMMMM:'
         `.  .'                   :    /:'       |-'MMMM.-'
          |  |                   .'   /'        .'MMM.-'
          `'`'                   :  ,'          |MMM<
            |                     `'            |tbap\
             \                                  :MM.-'
              \                 |              .''
               \.               `.            /
                /     .:::::::.. :           /
               |     .:::::::::::`.         /
               |   .:::------------\       /
              /   .''               >::'  /
              `',:                 :    .'
                                 
-->
